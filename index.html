<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CS4802 Final</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>

<body>
    <svg class="sunburst"></svg>

    <script>
        var nodeData = {
            "name": "CONTRIBUTORS OF EMISSIONS", "children": [{
                "name": "Energy",
                "children": [
                    { "name": "Energy In Agriculture and Fishing", "size": .17 },
                    { "name": "Emissions from Energy Producton", "size": 0.58 },
                    { "name": "Unallocated Fuel Emissions", "size": 0.78 },
                    { "name": "Energy Use in Buildings", "size": 1.75 },
                    { "name": "Transport", "size": 1.62 },
                    { "name": "Energy use in Industry", "size": 2.4 }]
            },
            {
                "name": "Industry",
                "children": [
                    { "name": "Cement", "size": 0.3 },
                    { "name": "Chemicals", "size": 0.22 }]
            },
            {
                "name": "Waste",
                "children": [{ "name": "Landfills", "size": 0.19 },
                { "name": "Wastewater", "size": 0.13 }]
            },
            {
                "name": "Agriculture Forestry and Land Use",
                "children": [{ "name": "Cropland", "size": 0.14 },
                { "name": "Deforestation", "size": 0.22 },
                { "name": "Crop Burning", "size": 0.35 },
                { "name": "Rice Cultivation", "size": 0.13 },
                { "name": "Agriculture Soils", "size": 0.41 },
                { "name": "Livestock and Manuer", "size": 0.58 }]
            }]
        };

        // Variables
        var width = 600;
        var height = 500;
        var radius = Math.min(width, height) / 2;
        var color = d3.scaleOrdinal(d3.schemeAccent);

        // Create primary <g> element
        var g = d3.select('svg')
            .attr('width', width)
            .attr('height', height)
            .append('g')
            .attr('transform', 'translate(' + width / 2 + ',' + height / 2 + ')');

        // Data strucure
        var partition = d3.partition()
            .size([2 * Math.PI, radius]);

        // Find data root
        var root = d3.hierarchy(nodeData)
            .sum(function (d) { return d.size });

        // Size arcs
        partition(root);
        var arc = d3.arc()
            .startAngle(function (d) { return d.x0 })
            .endAngle(function (d) { return d.x1 })
            .innerRadius(function (d) { return d.y0 })
            .outerRadius(function (d) { return d.y1 });

        var div = d3.select("body").append("div")
            .attr("class", "tooltip-donut")
            .style("opacity", 0)
            .style("background", "#808080")
            .style("stroke", "white")
            .style("stroke-width", "1px")
            .style("width", "300px")
            .style("color", "white")


        // Put it all together
        g.selectAll('path')
            .data(root.descendants())
            .enter().append('path')
            .attr("display", function (d) { return d.depth ? null : "none"; })
            .attr("d", arc)
            .style('stroke', 'black')
            .style("fill", function (d) { return color((d.children ? d : d.parent).data.name); })
            .on("mouseover", function (d, i) {
                div.html(`Sector: ${i.data.name}, ${i.data.size * 10}%`)
                    .transition()
                    .duration(50)
                    .style("opacity", 1)
                    .style("position", "relative")
                    .style("left", (d.clientX + 5) + "px")
                    .style("top", (d.clientY - 510) + "px");
            })
            .on("mouseout", function (d) {
                div.transition()
                    .duration('50')
                    .style("opacity", 0);
            })
            .style("cursor", "pointer");

        g.selectAll('slicesText')
            .data(root.descendants())
            .enter()
            .append('text')
            .text(function (d, i) { 
                if(d.data.size == null) {
                    return d.data.name;
                }
                else if(d.data.size > 0.4) {
                    return d.data.name;
                }
                else {
                    return "";
                }
            })
            .attr("transform", function (d) { return "translate(" + arc.centroid(d) + ")"; })
            .style("text-anchor", "middle")
            .style("font-size", function (d, i) {
                console.log(d)
                if(d.data.size == null) {
                    return 15;
                }
                else {
                    return 10;
                }
            })
    </script>
</body>

</html>